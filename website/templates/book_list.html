<!-- Extend the base template -->
{% extends "base.html" %}

<!-- Define the title for this page -->
{% block title %}
Book List
{% endblock %}

{% block content %}
<!-- Main content for the Book List page -->
<h1>List of Books</h1>

<!-- Show "Add Book" button only for admin users -->
{% if current_user.is_admin %}
    <a href="/add-book">
        <button class="btn btn-primary">Add Book</button>
    </a>
{% endif %}

<!-- Display the book list in a table format -->
<table>
    <!-- Table header with column names -->
    <thead>
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Author</th>
            <th>Total Copies</th>
            <th>Available Copies</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Loop through the list of books and display each book's details -->
        {% for row in books %}
        <tr>
            <!-- Book ID -->
            <td>{{ row.id }}</td>
            <!-- Book Name -->
            <td>{{ row.name }}</td>
            <!-- Author Name -->
            <td>{{ row.author }}</td>
            <!-- Total number of copies of the book -->
            <td>{{ row.copies }}</td>
            <!-- Number of available (non-borrowed) copies -->
            <td>{{ row.remaining_copies }}</td>
            <td>
                <!-- If the user is not an admin -->
                {% if not current_user.is_admin %}
                    <!-- Check if the user has not borrowed this book -->
                    {% if row.id not in borrowed_book_ids %}
                    <!-- Show a "Borrow" button to allow borrowing the book -->
                    <form action="/borrow-book/{{ row.id }}" method="POST">
                        <button type="submit" class="btn btn-success">Borrow</button>
                    </form>
                    {% else %}
                    <!-- If the book is already borrowed by the user, disable the "Borrow" button -->
                    <button class="btn btn-secondary" disabled>Borrowed</button>
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
