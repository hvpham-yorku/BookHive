{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">

<h2>Library Usage Reports</h2>

<h3>Most Borrowed Books</h3>
<table id="most-borrowed-books-table">
    <thead>
        <tr>
            <th>Book Name</th>
            <th>Borrow Count</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be dynamically added here -->
    </tbody>
</table>

<h3>Active Users</h3>
<p id="active-users"></p>

<h3>Borrowing Trends (Last 30 Days)</h3>
<div class="chart-container">
    <canvas id="borrowing-trends-chart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/reports/data')
            .then(response => response.json())
            .then(data => {
                // Populate Most Borrowed Books table
                const mostBorrowedTableBody = document.getElementById('most-borrowed-books-table').querySelector('tbody');
                mostBorrowedTableBody.innerHTML = '';
                data.most_borrowed_books.forEach(book => {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td>${book.name}</td><td>${book.count}</td>`;
                    mostBorrowedTableBody.appendChild(row);
                });
 
                // Display Active Users
                document.getElementById('active-users').textContent = `Total Active Users: ${data.active_users}`;

                // Render Borrowing Trends Chart
                const ctx = document.getElementById('borrowing-trends-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.borrowing_trends.map(trend => trend.date),
                        datasets: [{
                            label: 'Books Borrowed',
                            data: data.borrowing_trends.map(trend => trend.count),
                            borderColor: '#4CAF50',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Borrow Count'
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching report data:', error));
    });
</script>


{% endblock %}
